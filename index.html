<script>
  const btn = document.getElementById("refreshBtn");
  const codeDisplay = document.getElementById("codeDisplay");
  const statusEl = document.getElementById("status");

  let autoRefreshInterval;
  
  // Point this to your Worker URL
  const WORKER_URL = "https://roblox-verifier.everybodyhatescowlover4499.workers.dev";
  
  async function fetchCode() {
    try {
      statusEl.textContent = "Fetching code...";
      const res = await fetch(`${WORKER_URL}/api/get-code`);
      
      if (!res.ok) {
        throw new Error(`HTTP error! status: ${res.status}`);
      }
      
      const data = await res.json();
      
      if (data.code) {
        codeDisplay.textContent = data.code;
        statusEl.textContent = "Last updated: " + new Date().toLocaleTimeString();
      } else {
        codeDisplay.textContent = "No active code";
        statusEl.textContent = "No code available (try again later)";
      }
    } catch (err) {
      console.error("Error fetching code:", err);
      codeDisplay.textContent = "Error loading code";
      statusEl.textContent = "Failed to connect to server";
    }
  }

  function startAutoRefresh() {
    // Clear existing interval if it exists
    if (autoRefreshInterval) {
      clearInterval(autoRefreshInterval);
    }
    autoRefreshInterval = setInterval(fetchCode, 10000);
  }

  btn.onclick = async () => {
    btn.disabled = true;
    btn.innerText = "Refreshing...";
    await fetchCode();
    btn.disabled = false;
    btn.innerText = "Refresh Code";
  };

  // Initial load
  document.addEventListener('DOMContentLoaded', () => {
    fetchCode();
    startAutoRefresh();
  });
</script>
